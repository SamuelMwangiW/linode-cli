name: Main

on:
  push:
    tags:
      - v.*

jobs:
    build:
        runs-on: ubuntu-latest
        if: github.event.base_ref == 'refs/heads/main'
        steps:
            - uses: shivammathur/setup-php@15c43e89cdef867065b0213be354c2841860869e
              with:
                php-version: '8.0'
            - name: Checkout
              uses: actions/checkout@v2
            - name: Install Dependencies
              run: composer install -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist
            - name: Build
              run: php linode-cli app:build --build-version ${GITHUB_REF##*/}
            - name: Release
              uses: softprops/action-gh-release@v1
              with:
                  files: |
                      builds/linode-cli
